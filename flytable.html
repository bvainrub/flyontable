<!DOCTYPE html>
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–∞–ø–æ–º–Ω–∏—Ç—å –º—É—Ö—É</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');

  :root {
    --bg: #0a0a0f;
    --grid-bg: #0f0f1a;
    --cell: #13131f;
    --cell-border: #1e1e35;
    --fly: #00ff88;
    --accent: #ff3c6e;
    --gold: #ffd700;
    --text: #c8c8e8;
    --dim: #3a3a5c;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Share Tech Mono', monospace;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    user-select: none;
    padding: 8px 12px;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.07) 2px,rgba(0,0,0,0.07) 4px);
    pointer-events: none;
    z-index: 100;
  }

  /* Language switcher */
  .lang-bar {
    position: fixed;
    top: 12px; right: 14px;
    display: flex;
    gap: 4px;
    z-index: 200;
  }
  .lang-btn {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem; font-weight: 700;
    letter-spacing: 0.1em;
    padding: 4px 10px;
    border: 1px solid var(--cell-border);
    border-radius: 3px;
    background: transparent;
    color: var(--dim);
    cursor: pointer;
    transition: all 0.15s;
  }
  .lang-btn.active  { border-color: var(--fly); color: var(--fly); background: rgba(0,255,136,0.08); }
  .lang-btn:hover:not(.active) { border-color: var(--text); color: var(--text); }

  .title {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(0.9rem, 3.5vw, 1.7rem);
    font-weight: 900; letter-spacing: 0.22em;
    color: var(--fly);
    text-shadow: 0 0 20px rgba(0,255,136,0.5);
    margin-bottom: 2px; text-align: center;
  }
  .subtitle {
    font-size: 0.56rem; letter-spacing: 0.16em;
    color: var(--dim); margin-bottom: 10px;
  }

  .game-wrap {
    display: flex; flex-direction: column;
    align-items: center; gap: 6px;
    width: 100%; max-width: 500px;
    height: 100%;
    justify-content: center;
  }

  .status-bar {
    display: flex; gap: 16px;
    align-items: center; justify-content: center; width: 100%;
  }
  .stat { display: flex; flex-direction: column; align-items: center; gap: 1px; }
  .stat-label { color: var(--dim); font-size: 0.5rem; letter-spacing: 0.13em; }
  .stat-value { font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 700; color: var(--fly); }
  .stat-value.neg { color: var(--accent); }

  .timer-wrap { width: 100%; height: 4px; background: var(--cell-border); border-radius: 2px; overflow: hidden; }
  .timer-fill { height: 100%; background: linear-gradient(90deg,var(--accent),var(--gold)); box-shadow: 0 0 6px rgba(255,215,0,0.4); }
  .timer-fill.urgent { background: var(--accent); }

  .level-wrap { width: 100%; }
  .level-bar  { width: 100%; height: 3px; background: var(--cell-border); border-radius: 2px; overflow: hidden; }
  .level-fill { height: 100%; background: linear-gradient(90deg,var(--fly),var(--gold)); transition: width 0.5s ease; box-shadow: 0 0 6px rgba(0,255,136,0.5); }
  .level-info { display: flex; justify-content: space-between; font-size: 0.5rem; color: var(--dim); margin-top: 3px; }

  .size-row {
    display: flex; align-items: center; gap: 8px;
    font-size: 0.58rem; letter-spacing: 0.1em; color: var(--dim);
    background: var(--cell); border: 1px solid var(--cell-border);
    padding: 5px 12px; border-radius: 4px;
  }
  .size-btn {
    font-family: 'Orbitron', sans-serif; font-size: 1rem; font-weight: 700;
    color: var(--fly); background: transparent;
    border: 1px solid var(--cell-border); border-radius: 3px;
    width: 24px; height: 24px; cursor: pointer; transition: all 0.15s;
    display: flex; align-items: center; justify-content: center; line-height: 1;
  }
  .size-btn:hover:not(:disabled) { border-color: var(--fly); background: rgba(0,255,136,0.1); }
  .size-btn:disabled { color: var(--dim); cursor: default; }
  .size-val {
    font-family: 'Orbitron', sans-serif; font-size: 0.78rem; font-weight: 700;
    color: var(--text); min-width: 50px; text-align: center;
  }

  .grid-wrapper { position: relative; border-radius: 3px; overflow: hidden; transition: box-shadow 0.25s; }
  .grid-wrapper.glow-red   { box-shadow: 0 0 45px rgba(255,60,110,0.6); }
  .grid-wrapper.glow-green { box-shadow: 0 0 45px rgba(0,255,136,0.6); }

  #grid {
    display: grid; background: var(--grid-bg);
    border: 1px solid var(--cell-border); gap: 2px; padding: 2px;
    transition: background 0.25s;
  }
  #grid.bg-red   { background: rgba(255,60,110,0.12); }
  #grid.bg-green { background: rgba(0,255,136,0.10); }

  .cell {
    background: var(--cell); border: 1px solid var(--cell-border);
    display: flex; align-items: center; justify-content: center;
    position: relative; aspect-ratio: 1;
  }
  .cell.has-fly { background: rgba(0,255,136,0.07); }
  .cell-label { position: absolute; top: 2px; left: 2px; font-size: 0.36rem; color: var(--dim); opacity: 0.4; }

  .fly { font-size: 1.2em; filter: drop-shadow(0 0 5px var(--fly)); animation: flyFloat 2s ease-in-out infinite; }
  @keyframes flyFloat { 0%,100%{transform:translateY(0) rotate(-5deg)} 50%{transform:translateY(-3px) rotate(5deg)} }

  .command-box {
    height: 50px; display: flex; align-items: center; justify-content: center;
    font-family: 'Orbitron', sans-serif; font-size: 0.95rem; font-weight: 700;
    letter-spacing: 0.15em; color: var(--gold);
    text-shadow: 0 0 10px rgba(255,215,0,0.35);
    background: rgba(255,215,0,0.04); border: 1px solid rgba(255,215,0,0.13);
    border-radius: 4px; width: 100%; overflow: hidden; position: relative;
  }
  .command-box::before {
    content:''; position:absolute; inset:0;
    background: linear-gradient(90deg,transparent,rgba(255,215,0,0.04),transparent);
    animation: sweep 3s ease-in-out infinite;
  }
  @keyframes sweep { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
  .command-text { position: relative; z-index: 1; }

  .phase-indicator {
    font-size: 0.58rem; letter-spacing: 0.11em; color: var(--dim);
    text-align: center; min-height: 1.2em;
  }
  .phase-indicator span      { color: var(--fly); }
  .phase-indicator span.warn { color: var(--accent); }

  .arrows-hint {
    display: grid;
    grid-template-columns: repeat(3,32px);
    grid-template-rows: repeat(2,32px);
    gap: 4px;
  }
  .arr-key {
    background: var(--cell); border: 1px solid var(--cell-border);
    border-radius: 4px; display: flex; align-items: center; justify-content: center;
    font-size: 0.85rem; color: var(--dim); transition: all 0.1s;
  }
  .arr-key.hit-ok  { background: rgba(0,255,136,0.2);  border-color: var(--fly);    color: var(--fly);    box-shadow: 0 0 8px rgba(0,255,136,0.3); }
  .arr-key.hit-bad { background: rgba(255,60,110,0.2); border-color: var(--accent); color: var(--accent); box-shadow: 0 0 8px rgba(255,60,110,0.3); }
  .arr-key.up    { grid-column:2; grid-row:1; }
  .arr-key.left  { grid-column:1; grid-row:2; }
  .arr-key.down  { grid-column:2; grid-row:2; }
  .arr-key.right { grid-column:3; grid-row:2; }

  .btn-row { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
  .btn {
    font-family: 'Orbitron', sans-serif; font-size: 0.6rem; font-weight: 700;
    letter-spacing: 0.1em; padding: 8px 16px;
    border: 1px solid; border-radius: 2px; cursor: pointer;
    background: transparent; transition: all 0.18s; text-transform: uppercase;
  }
  .btn-start { color: var(--fly);   border-color: var(--fly); }
  .btn-start:hover:not(:disabled) { background: rgba(0,255,136,0.1); box-shadow: 0 0 14px rgba(0,255,136,0.2); }
  .btn-space { color: var(--gold);  border-color: var(--gold); }
  .btn-space:hover:not(:disabled)  { background: rgba(255,215,0,0.1); }
  .btn-space:disabled { opacity: 0.3; cursor: default; }
  .btn-reset { color: var(--dim);   border-color: var(--dim); font-size: 0.55rem; }
  .btn-reset:hover { color: var(--accent); border-color: var(--accent); }

  /* Spectator toggle */
  .spectator-row {
    display: flex; align-items: center; gap: 10px;
    font-size: 0.56rem; letter-spacing: 0.1em; color: var(--dim);
  }
  .toggle-wrap {
    position: relative; width: 36px; height: 18px; cursor: pointer;
  }
  .toggle-wrap input { opacity: 0; width: 0; height: 0; position: absolute; }
  .toggle-track {
    position: absolute; inset: 0;
    background: var(--cell-border); border-radius: 9px;
    transition: background 0.2s;
  }
  .toggle-wrap input:checked + .toggle-track { background: rgba(0,255,136,0.35); border: 1px solid var(--fly); }
  .toggle-knob {
    position: absolute; top: 2px; left: 2px;
    width: 14px; height: 14px; border-radius: 50%;
    background: var(--dim);
    transition: transform 0.2s, background 0.2s;
    pointer-events: none;
  }
  .toggle-wrap input:checked ~ .toggle-knob { transform: translateX(18px); background: var(--fly); box-shadow: 0 0 6px rgba(0,255,136,0.5); }

  .result-overlay {
    position: fixed; inset: 0; background: rgba(10,10,15,0.93);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 50; gap: 12px; backdrop-filter: blur(6px);
    opacity: 0; pointer-events: none; transition: opacity 0.3s;
    padding: 20px; text-align: center;
  }
  .result-overlay.show { opacity: 1; pointer-events: all; }
  .result-title { font-family: 'Orbitron', sans-serif; font-size: clamp(1.8rem,6vw,3rem); font-weight: 900; letter-spacing: 0.2em; }
  .result-title.win  { color: var(--fly);    text-shadow: 0 0 40px rgba(0,255,136,0.7); }
  .result-title.lose { color: var(--accent); text-shadow: 0 0 40px rgba(255,60,110,0.7); }
  .result-score  { font-family: 'Orbitron', sans-serif; font-size: 1.3rem; color: var(--gold); }
  .result-detail { font-size: 0.7rem; color: var(--dim); line-height: 1.9; white-space: pre-line; }
  .level-up-badge { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; color: var(--gold); letter-spacing: 0.2em; animation: blink 1s ease infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ‚îÄ‚îÄ HELP BUTTON ‚îÄ‚îÄ */
  .help-btn {
    position: fixed;
    top: 12px; left: 14px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem; font-weight: 700;
    letter-spacing: 0.1em;
    padding: 4px 10px;
    border: 1px solid var(--fly);
    border-radius: 3px;
    background: rgba(0,255,136,0.08);
    color: var(--fly);
    cursor: pointer;
    transition: all 0.15s;
    z-index: 200;
    text-shadow: 0 0 8px rgba(0,255,136,0.4);
  }
  .help-btn:hover {
    border-color: var(--gold);
    color: var(--gold);
    background: rgba(255,215,0,0.10);
    text-shadow: 0 0 10px rgba(255,215,0,0.5);
    box-shadow: 0 0 12px rgba(255,215,0,0.2);
  }

  /* ‚îÄ‚îÄ HELP PANEL ‚îÄ‚îÄ */
  .help-overlay {
    position: fixed; inset: 0;
    background: rgba(10,10,15,0.6);
    z-index: 300;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
    backdrop-filter: blur(3px);
  }
  .help-overlay.show { opacity: 1; pointer-events: all; }

  .help-panel {
    position: fixed;
    top: 0; left: 0;
    width: min(380px, 92vw);
    height: 100vh;
    background: #0d0d18;
    border-right: 1px solid var(--cell-border);
    z-index: 301;
    display: flex; flex-direction: column;
    transform: translateX(-100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    box-shadow: 6px 0 40px rgba(0,0,0,0.6);
  }
  .help-panel.show { transform: translateX(0); }

  .help-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--cell-border);
    flex-shrink: 0;
  }
  .help-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.85rem; font-weight: 700;
    letter-spacing: 0.2em; color: var(--fly);
  }
  .help-close {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem; font-weight: 700;
    color: var(--dim); background: transparent;
    border: 1px solid var(--cell-border); border-radius: 3px;
    width: 28px; height: 28px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }
  .help-close:hover { color: var(--accent); border-color: var(--accent); }

  .help-body {
    overflow-y: auto; flex: 1;
    padding: 20px 20px 30px;
    scrollbar-width: thin;
    scrollbar-color: var(--cell-border) transparent;
  }
  .help-body::-webkit-scrollbar { width: 4px; }
  .help-body::-webkit-scrollbar-thumb { background: var(--cell-border); border-radius: 2px; }

  .help-section { margin-bottom: 24px; }
  .help-section-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.65rem; font-weight: 700;
    letter-spacing: 0.18em; color: var(--gold);
    margin-bottom: 10px;
    padding-bottom: 4px;
    border-bottom: 1px solid rgba(255,215,0,0.15);
  }
  .help-text {
    font-size: 0.68rem; line-height: 1.85;
    color: var(--text); letter-spacing: 0.03em;
  }
  .help-text p { margin-bottom: 8px; }
  .help-text p:last-child { margin-bottom: 0; }
  .hl-green { color: var(--fly); font-weight: bold; }
  .hl-red   { color: var(--accent); font-weight: bold; }
  .hl-gold  { color: var(--gold); font-weight: bold; }

  .help-rule {
    display: flex; gap: 10px; align-items: flex-start;
    margin-bottom: 8px;
  }
  .help-rule-icon {
    flex-shrink: 0; width: 20px; height: 20px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.6rem; font-weight: bold; margin-top: 1px;
  }
  .icon-green { background: rgba(0,255,136,0.15); color: var(--fly); border: 1px solid rgba(0,255,136,0.3); }
  .icon-red   { background: rgba(255,60,110,0.15); color: var(--accent); border: 1px solid rgba(255,60,110,0.3); }
  .icon-gold  { background: rgba(255,215,0,0.12); color: var(--gold); border: 1px solid rgba(255,215,0,0.25); }

  .help-score-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 6px 10px; margin-bottom: 5px;
    background: var(--cell); border: 1px solid var(--cell-border); border-radius: 3px;
    font-size: 0.63rem;
  }
  .help-score-val { font-family: 'Orbitron', sans-serif; font-size: 0.75rem; font-weight: 700; }
</style>

<style>
	@font-face {
		font-family: 'CameraPlainVariable';
		src: url('https://cdn.gpteng.co/mcp-widgets/v1/fonts/CameraPlainVariable.woff2') format('woff2');
		font-weight: 100 900;
		font-style: normal;
		font-display: swap;
	}

	#lovable-badge {
		--badge-bg: #1b1b1b;
		--badge-text: #c5c1b9;
		--badge-text-hover: #dcdad5;
		--badge-radius: 6px;
		--badge-padding: 8px;
		--badge-gap: 6px;
		--badge-shadow: 
			0 0 0 1px rgba(0, 0, 0, 0.88),
			0 1px 0 0 rgba(0, 0, 0, 0.04),
			0 2px 2px -1px rgba(0, 0, 0, 0.08),
			0 4px 4px -2px rgba(0, 0, 0, 0.08),
			0 8px 8px -4px rgba(0, 0, 0, 0.08),
			0 16px 16px -8px rgba(0, 0, 0, 0.08);
		--badge-transition-duration: 0.2s;
		--badge-transition-easing: cubic-bezier(0.16, 1, 0.32, 1);
		--focus-color: #575ECF;
		--focus-offset: 2px;
		--focus-width: 2px;
		
		position: fixed;
		bottom: 12px;
		right: 12px;
		height: 24px;
		display: flex;
		align-items: center;
		z-index: 1000000;
		background-color: var(--badge-bg);
		color: var(--badge-text);
		border-radius: var(--badge-radius);
		box-shadow: var(--badge-shadow);
		font-size: 12px;
		font-family: CameraPlainVariable, "CameraPlainVariable Fallback", -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
		font-weight: 400 !important;
		text-transform: none !important;
		font-feature-settings: normal !important;
		transform: translateZ(0);
		will-change: transform, opacity;
	}

	#lovable-badge-cta {
		display: flex;
		align-items: center;
		gap: var(--badge-gap);
		padding: 0 var(--badge-padding);
		height: 100%;
		color: inherit;
		text-decoration: none;
		white-space: nowrap;
		border-radius: var(--badge-radius) 0 0 var(--badge-radius);
		transition: 
			background-color var(--badge-transition-duration) ease,
			color var(--badge-transition-duration) ease,
			transform 0.1s ease;
	}

	#lovable-badge-cta:hover {
		background: rgba(255, 255, 255, 0.04);
		color: var(--badge-text-hover);
	}

	#lovable-badge-cta:active {
		transform: scale(0.98);
	}

	#lovable-badge-cta:focus {
		outline: none;
	}

	#lovable-badge-cta:focus-visible {
		outline: var(--focus-width) solid var(--focus-color);
		outline-offset: var(--focus-offset);
		z-index: 1;
	}

	#lovable-badge-text {
		line-height: 1;
	}

	#lovable-badge-divider {
		width: 1px;
		height: 24px;
		background-color: rgba(255, 255, 255, 0.04);
		flex-shrink: 0;
	}

	#lovable-badge-close {
		width: 24px;
		height: 24px;
		min-width: 24px;
		min-height: 24px;
		cursor: pointer;
		background: none;
		border: none;
		padding: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 0 var(--badge-radius) var(--badge-radius) 0;
		flex-shrink: 0;
		transition: 
			background-color var(--badge-transition-duration) ease,
			transform 0.1s ease;
	}

	#lovable-badge-close:hover {
		background: rgba(255, 255, 255, 0.04);
	}

	#lovable-badge-close:active {
		transform: scale(0.92);
	}

	#lovable-badge-close:focus {
		outline: none;
	}

	#lovable-badge-close:focus-visible {
		outline: var(--focus-width) solid var(--focus-color);
		outline-offset: calc(var(--focus-offset) * -1);
		z-index: 1;
	}

	#lovable-badge-close svg path {
		fill: var(--badge-text);
		transition: fill var(--badge-transition-duration) ease;
	}

	#lovable-badge-close:hover svg path {
		fill: var(--badge-text-hover);
	}

	@media (prefers-reduced-motion: reduce) {
		#lovable-badge-cta,
		#lovable-badge-close,
		#lovable-badge-close svg path {
			transition: none;
		}
		
		#lovable-badge-cta:active,
		#lovable-badge-close:active {
			transform: none;
		}
	}

	@media (prefers-contrast: high) {
		#lovable-badge {
			--badge-bg: #000;
			--badge-text: #fff;
			--badge-text-hover: #fff;
			border: 2px solid currentColor;
		}
		
		#lovable-badge-cta:focus-visible,
		#lovable-badge-close:focus-visible {
			outline-width: 3px;
		}
	}
</style>
<meta name="twitter:image" content="https://pub-bb2e103a32db4e198524a2e9ed8f35b4.r2.dev/8ff5792c-bb8d-461d-a941-97e5eb69007e/id-preview-0f5813d1--ce9325ac-acf6-44f5-b1ec-8ef7941df7a6.lovable.app-1772143669105.png"></head>
<body>

<!-- Help button -->
<button class="help-btn" id="helpBtn" onclick="openHelp()">? –ü–†–ê–í–ò–õ–ê</button>

<!-- Language switcher -->
<div class="lang-bar">
  <button class="lang-btn active" id="btnRU" onclick="setLang(&#39;ru&#39;)">RU</button>
  <button class="lang-btn" id="btnEN" onclick="setLang(&#39;en&#39;)">EN</button>
</div>

<div class="game-wrap">
  <div class="title" id="appTitle">–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–£–•–£</div>
  <div class="subtitle" id="appSubtitle">–¢–†–ï–ù–ò–†–û–í–ö–ê –ü–ê–ú–Ø–¢–ò –ò –í–ù–ò–ú–ê–ù–ò–Ø</div>

  <div class="status-bar">
    <div class="stat">
      <div class="stat-label" id="lblScore">–°–ß–Å–¢</div>
      <div class="stat-value" id="scoreDisplay">0</div>
    </div>
    <div class="stat">
      <div class="stat-label" id="lblRound">–†–ê–£–ù–î</div>
      <div class="stat-value" id="roundDisplay">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-label" id="lblLevel">–£–†–û–í–ï–ù–¨</div>
      <div class="stat-value" id="winsDisplay">1</div>
    </div>
    <div class="stat">
      <div class="stat-label" id="lblSpeed">–°–ö–û–†–û–°–¢–¨</div>
      <div style="display:flex;gap:4px;align-items:center">
        <button class="size-btn" onclick="changeSpeed(-1)" id="speedDown" disabled="">‚àí</button>
        <span class="size-val" id="speedVal" style="min-width:18px;font-size:0.72rem">1</span>
        <button class="size-btn" onclick="changeSpeed(1)" id="speedUp">+</button>
      </div>
    </div>
  </div>

  <div class="level-wrap">
    <div class="level-bar"><div class="level-fill" id="levelFill" style="width:0%"></div></div>
    <div class="level-info">
      <span id="levelLabel">–£–†–û–í–ï–ù–¨ 1</span>
      <span id="levelNext">–¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ: 100 –æ—á–∫–æ–≤</span>
    </div>
  </div>

  <div class="timer-wrap"><div class="timer-fill" id="timerFill" style="width:100%"></div></div>

  <div class="size-row">
    <span id="lblGrid">–ü–û–õ–ï:</span>
    <button class="size-btn" id="sizeDown" onclick="changeSize(-1)" disabled="">‚àí</button>
    <span class="size-val" id="sizeVal">5 √ó 5</span>
    <button class="size-btn" id="sizeUp" onclick="changeSize(1)">+</button>
    <span style="font-size:0.46rem;color:var(--dim)">(5‚Äì20)</span>
    <span style="flex:1"></span>
    <span class="spectator-row">
      <span id="lblSpectator">–ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨</span>
      <label class="toggle-wrap">
        <input type="checkbox" id="spectatorToggle" onchange="toggleSpectator(this.checked)">
        <div class="toggle-track"></div>
        <div class="toggle-knob"></div>
      </label>
    </span>
  </div>

  <div class="grid-wrapper" id="gridWrapper"><div id="grid" style="grid-template-columns: repeat(5, 56px); grid-template-rows: repeat(5, 56px);"><div class="cell" id="c-0-0"><span class="cell-label">A1</span></div><div class="cell" id="c-1-0"><span class="cell-label">B1</span></div><div class="cell" id="c-2-0"><span class="cell-label">C1</span></div><div class="cell" id="c-3-0"><span class="cell-label">D1</span></div><div class="cell" id="c-4-0"><span class="cell-label">E1</span></div><div class="cell" id="c-0-1"><span class="cell-label">A2</span></div><div class="cell" id="c-1-1"><span class="cell-label">B2</span></div><div class="cell" id="c-2-1"><span class="cell-label">C2</span></div><div class="cell" id="c-3-1"><span class="cell-label">D2</span></div><div class="cell" id="c-4-1"><span class="cell-label">E2</span></div><div class="cell" id="c-0-2"><span class="cell-label">A3</span></div><div class="cell" id="c-1-2"><span class="cell-label">B3</span></div><div class="cell" id="c-2-2"><span class="cell-label">C3</span></div><div class="cell" id="c-3-2"><span class="cell-label">D3</span></div><div class="cell" id="c-4-2"><span class="cell-label">E3</span></div><div class="cell" id="c-0-3"><span class="cell-label">A4</span></div><div class="cell" id="c-1-3"><span class="cell-label">B4</span></div><div class="cell" id="c-2-3"><span class="cell-label">C4</span></div><div class="cell" id="c-3-3"><span class="cell-label">D4</span></div><div class="cell" id="c-4-3"><span class="cell-label">E4</span></div><div class="cell" id="c-0-4"><span class="cell-label">A5</span></div><div class="cell" id="c-1-4"><span class="cell-label">B5</span></div><div class="cell" id="c-2-4"><span class="cell-label">C5</span></div><div class="cell" id="c-3-4"><span class="cell-label">D5</span></div><div class="cell" id="c-4-4"><span class="cell-label">E5</span></div></div></div>

  <div class="command-box"><span class="command-text" id="commandText">–ù–ê–ñ–ú–ò –°–¢–ê–†–¢</span></div>

  <div class="phase-indicator" id="phaseText">‚Äî –≤—ã–±–µ—Ä–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏ –°–¢–ê–†–¢ ‚Äî</div>

  <div class="arrows-hint">
    <div class="arr-key up" id="key-up">‚Üë</div>
    <div class="arr-key left" id="key-left">‚Üê</div>
    <div class="arr-key down" id="key-down">‚Üì</div>
    <div class="arr-key right" id="key-right">‚Üí</div>
  </div>

  <div class="btn-row">
    <button class="btn btn-start" id="startBtn" onclick="startGame()">‚ñ∂ –°–¢–ê–†–¢</button>
    <button class="btn btn-space" id="spaceBtn" onclick="_handleSpace()" disabled="">‚éµ –°–¢–û–ü</button>
    <button class="btn btn-reset" id="resetBtn" onclick="resetScore()">‚Ü∫ –°–ë–†–û–°</button>
  </div>
</div>

<div class="result-overlay" id="resultOverlay">
  <div class="result-title" id="resultTitle">‚Äî</div>
  <div class="result-score" id="resultScore"></div>
  <div class="result-detail" id="resultDetail"></div>
  <div class="level-up-badge" id="levelUpBadge" style="display:none">‚¨Ü –£–†–û–í–ï–ù–¨ –í–í–ï–†–•!</div>
  <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;justify-content:center">
    <button class="btn btn-start" id="resultPlayBtn" onclick="closeResult()">‚ñ∂ –ï–©–Å –†–ê–ó</button>
    <button class="btn btn-reset" id="resultResetBtn" onclick="resetAll()">‚Ü∫ –ü–û–õ–ù–´–ô –°–ë–†–û–°</button>
  </div>
</div>

<!-- Help overlay backdrop -->
<div class="help-overlay" id="helpOverlay" onclick="closeHelp()"></div>

<!-- Help sliding panel -->
<div class="help-panel" id="helpPanel">
  <div class="help-header">
    <div class="help-title" id="helpTitleEl">–ü–†–ê–í–ò–õ–ê –ò–ì–†–´</div>
    <button class="help-close" onclick="closeHelp()">‚úï</button>
  </div>
  <div class="help-body" id="helpBody">
    <!-- filled by JS -->
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const T = {
  ru: {
    title:        '–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–£–•–£',
    subtitle:     '–¢–†–ï–ù–ò–†–û–í–ö–ê –ü–ê–ú–Ø–¢–ò –ò –í–ù–ò–ú–ê–ù–ò–Ø',
    lblScore:     '–°–ß–Å–¢',
    lblRound:     '–†–ê–£–ù–î',
    lblLevel:     '–£–†–û–í–ï–ù–¨',
    lblSpeed:     '–°–ö–û–†–û–°–¢–¨',
    lblGrid:      '–ü–û–õ–ï:',
    cmdStart:     '–ù–ê–ñ–ú–ò –°–¢–ê–†–¢',
    phaseIdle:    '‚Äî –≤—ã–±–µ—Ä–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏ –°–¢–ê–†–¢ ‚Äî',
    phaseMemorize:'‚Äî <span>–∑–∞–ø–æ–º–Ω–∏</span> ‚Äî –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞ ‚Äî —Å–ª—É—à–∞–π –∫–æ–º–∞–Ω–¥—ã ‚Äî',
    phasePlaying: '‚Äî <span>–≥–ª–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç—ã</span> ‚Äî —Å–ª—É—à–∞–π –∏ –Ω–∞–∂–∏–º–∞–π —Å—Ç—Ä–µ–ª–∫–∏ ‚Äî',
    phaseFlyOut:  '‚Äî –º—É—Ö–∞ –≤—ã—à–ª–∞! –Ω–∞–∂–º–∏ <span class="warn">–°–¢–û–ü</span> ‚Äî',
    phasePenalty: n => `‚Äî <span class="warn">—à—Ç—Ä–∞—Ñ √ó${n}!</span> –Ω–∞–∂–º–∏ <span class="warn">–°–¢–û–ü</span>! ‚Äî`,
    cmdMemorize:  '–ó–ê–ü–û–ú–ù–ò –ü–û–ó–ò–¶–ò–Æ',
    cmdWait:      '...',
    btnStart:     '‚ñ∂ –°–¢–ê–†–¢',
    btnStop:      '‚éµ –°–¢–û–ü',
    btnReset:     '‚Ü∫ –°–ë–†–û–°',
    btnAgain:     '‚ñ∂ –ï–©–Å –†–ê–ó',
    btnFullReset: '‚Ü∫ –ü–û–õ–ù–´–ô –°–ë–†–û–°',
    levelLabel:   n => `–£–†–û–í–ï–ù–¨ ${n}`,
    levelNext:    n => `–¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ: ${n} –æ—á–∫–æ–≤`,
    resultWin:    '–¢–û–ß–ù–û!',
    resultLose:   '–ü–†–û–ú–ê–•!',
    detailWin:    n => `–ú—É—Ö–∞ –≤—ã—à–ª–∞ –ø–æ—Å–ª–µ ${n} –∫–æ–º–∞–Ω–¥.\n–û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è! –ù–∏ –æ–¥–Ω–æ–≥–æ —à—Ç—Ä–∞—Ñ–∞.`,
    detailTooEarly: '–ú—É—Ö–∞ –µ—â—ë –±—ã–ª–∞ –≤ –ø–æ–ª–µ!\n–ù–∞–∂–∞–ª —Å—Ç–æ–ø —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ.',
    detailPenalty:  n => `–ú—É—Ö–∞ –≤—ã—à–ª–∞, –Ω–æ —Ç—ã –Ω–∞–∂–∞–ª —Å—Ç—Ä–µ–ª–∫–∏ √ó${n} –≤–º–µ—Å—Ç–æ –°–¢–û–ü.\n–≠—Ç–æ –ø—Ä–æ–∏–≥—Ä—ã—à!`,
    levelUpBadge: '‚¨Ü –£–†–û–í–ï–ù–¨ –í–í–ï–†–•!',
    cmds:     ['–≤–≤–µ—Ä—Ö','–≤–Ω–∏–∑','–≤–ª–µ–≤–æ','–≤–ø—Ä–∞–≤–æ'],
    speakCmd: cmd => `–º—É—Ö–∞ ${cmd}`,
    dispCmd:  cmd => `–ú–£–•–ê ‚Äî ${cmd.toUpperCase()}`,
    ttsLang:  'ru-RU',
    helpBtn:  '? –ü–†–ê–í–ò–õ–ê',
    helpTitle:'–ü–†–ê–í–ò–õ–ê –ò–ì–†–´',
    lblSpectator: '–ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨',
    helpHTML: `
<div class="help-section">
  <div class="help-section-title">üéØ –ß–¢–û –≠–¢–û –ó–ê –ò–ì–†–ê?</div>
  <div class="help-text">
    <p>¬´–ó–∞–ø–æ–º–Ω–∏—Ç—å –º—É—Ö—É¬ª ‚Äî —Ç—Ä–µ–Ω–∞–∂—ë—Ä –ø–∞–º—è—Ç–∏ –∏ –≤–Ω–∏–º–∞–Ω–∏—è. –ú—É—Ö–∞ —Å–∏–¥–∏—Ç –Ω–∞ –∫–ª–µ—Ç–∫–µ –ø–æ–ª—è. –¢—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ—à—å –µ—ë –ø–æ–∑–∏—Ü–∏—é, –∑–∞–∫—Ä—ã–≤–∞–µ—à—å –≥–ª–∞–∑–∞ –∏ –Ω–∞ —Å–ª—É—Ö —Å–ª–µ–¥–∏—à—å –∑–∞ –µ—ë –¥–≤–∏–∂–µ–Ω–∏–µ–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≤–æ–≤—Ä–µ–º—è –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ –º—É—Ö–∞ –≤—ã—à–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ø–æ–ª—è, –∏ –Ω–∞–∂–∞—Ç—å <span class="hl-gold">–°–¢–û–ü</span>.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üïµÔ∏è –ò–°–¢–û–†–ò–Ø: –¢–†–ï–ù–ò–†–û–í–ö–ê –°–ü–ï–¶–°–õ–£–ñ–ë</div>
  <div class="help-text">
    <p>–≠—Ç–∞ –º–µ—Ç–æ–¥–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∞–≥–µ–Ω—Ç–æ–≤ —Ä–∞–∑–≤–µ–¥–∫–∏ –∏ –∫–æ–Ω—Ç—Ä—Ä–∞–∑–≤–µ–¥–∫–∏ –≤ —Ä—è–¥–µ —Å–ø–µ—Ü—Å–ª—É–∂–±. –û—Ñ–∏—Ü–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏ —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ö–µ–º—ã ‚Äî —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –º–∞—Ä—à—Ä—É—Ç—ã, –ø–æ–∑–∏—Ü–∏–∏ ‚Äî –∏ –º—ã—Å–ª–µ–Ω–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–µ –∏–º–µ—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å–∏.</p>
    <p>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç <span class="hl-green">–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º</span> ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –Ω–∞–≤—ã–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —É—Å–ª–æ–≤–∏—è—Ö, –≥–¥–µ –æ—à–∏–±–∫–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –ª—ë—Ç—á–∏–∫–æ–≤, –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤ –∏ —à–∞—Ö–º–∞—Ç–∏—Å—Ç–æ–≤ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìã –ö–ê–ö –ò–ì–†–ê–¢–¨ ‚Äî –®–ê–ì –ó–ê –®–ê–ì–û–ú</div>
  <div class="help-text">
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">1</div>
      <p><span class="hl-gold">–ù–∞—Å—Ç—Ä–æ–π –ø–æ–ª–µ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å.</span> –í—ã–±–µ—Ä–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è –æ—Ç 5√ó5 –¥–æ 20√ó20 –∏ —Å–∫–æ—Ä–æ—Å—Ç—å 1‚Äì3. –°–∫–æ—Ä–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">2</div>
      <p><span class="hl-gold">–ù–∞–∂–º–∏ –°–¢–ê–†–¢.</span> –ú—É—Ö–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –ø–æ–ª–µ. –£ —Ç–µ–±—è –µ—Å—Ç—å 3 —Å–µ–∫—É–Ω–¥—ã ‚Äî <span class="hl-green">–∑–∞–ø–æ–º–Ω–∏ –µ—ë –ø–æ–∑–∏—Ü–∏—é.</span></p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">3</div>
      <p><span class="hl-gold">–ó–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞.</span> –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–ø–æ–º–Ω–µ–Ω–∞ ‚Äî –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞. –ú—É—Ö–∞ –∏—Å—á–µ–∑–Ω–µ—Ç —Å —ç–∫—Ä–∞–Ω–∞.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">4</div>
      <p><span class="hl-gold">–°–ª—É—à–∞–π –∫–æ–º–∞–Ω–¥—ã.</span> –ì–æ–ª–æ—Å –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å ¬´–ú—É—Ö–∞ ‚Äî –≤–≤–µ—Ä—Ö¬ª, ¬´–ú—É—Ö–∞ ‚Äî –≤–ª–µ–≤–æ¬ª –∏ —Ç.–¥. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–∞–∂–∏–º–∞–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é <span class="hl-green">—Å—Ç—Ä–µ–ª–∫—É</span> –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ ‚Äî —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Ç—ã —É—Å–ª—ã—à–∞–ª.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">5</div>
      <p><span class="hl-gold">–°–ª–µ–¥–∏ –º—ã—Å–ª–µ–Ω–Ω–æ.</span> –î–µ—Ä–∂–∏ –ø–æ–∑–∏—Ü–∏—é –º—É—Ö–∏ –≤ –≥–æ–ª–æ–≤–µ. –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–≤–∏–≥–∞–µ—Ç –µ—ë –Ω–∞ –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">6</div>
      <p>–ö–æ–≥–¥–∞ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ –ø–æ—Å–ª–µ –æ—á–µ—Ä–µ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –º—É—Ö–∞ <span class="hl-red">–≤—ã—à–ª–∞ –∑–∞ –∫—Ä–∞–π –ø–æ–ª—è</span> ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞–∂–º–∏ <span class="hl-gold">–°–¢–û–ü (–ø—Ä–æ–±–µ–ª)</span>.</p>
    </div>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üèÜ –°–ò–°–¢–ï–ú–ê –û–ß–ö–û–í</div>
  <div class="help-text">
    <div class="help-score-row">
      <span>–ù–∞–∂–∞–ª –°–¢–û–ü —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –º—É—Ö–∏</span>
      <span class="help-score-val hl-green">+10</span>
    </div>
    <div class="help-score-row">
      <span>–ù–∞–∂–∞–ª —Å—Ç—Ä–µ–ª–∫—É –≤–º–µ—Å—Ç–æ –°–¢–û–ü (–º—É—Ö–∞ —É–∂–µ –≤—ã—à–ª–∞)</span>
      <span class="help-score-val hl-red">‚àí1 –∑–∞ –∫–∞–∂–¥–æ–µ</span>
    </div>
    <div class="help-score-row">
      <span>–ù–∞–∂–∞–ª –°–¢–û–ü –∫–æ–≥–¥–∞ –º—É—Ö–∞ –µ—â—ë –Ω–∞ –ø–æ–ª–µ</span>
      <span class="help-score-val hl-red">‚àí5</span>
    </div>
    <p style="margin-top:10px">–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –º—É—Ö–∏ —Ç—ã –Ω–∞–∂–∞–ª —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Ç—Ä–µ–ª–∫—É ‚Äî —ç—Ç–æ <span class="hl-red">–ø—Ä–æ–∏–≥—Ä—ã—à</span>, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Ç–æ–º –Ω–∞–∂–∞–ª –°–¢–û–ü.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">‚è± –¢–ê–ô–ú–ï–† –ò –°–ö–û–†–û–°–¢–¨</div>
  <div class="help-text">
    <p>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª–æ—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞. –£ —Ç–µ–±—è –µ—Å—Ç—å –≤—Ä–µ–º—è –Ω–∞–∂–∞—Ç—å —Å—Ç—Ä–µ–ª–∫—É ‚Äî –∏–Ω–∞—á–µ —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–∏–¥—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
    <div class="help-score-row"><span>–°–∫–æ—Ä–æ—Å—Ç—å 1 (–º–µ–¥–ª–µ–Ω–Ω–æ)</span><span class="help-score-val hl-gold">10 —Å–µ–∫</span></div>
    <div class="help-score-row"><span>–°–∫–æ—Ä–æ—Å—Ç—å 2 (—Å—Ä–µ–¥–Ω–µ)</span><span class="help-score-val hl-gold">7 —Å–µ–∫</span></div>
    <div class="help-score-row"><span>–°–∫–æ—Ä–æ—Å—Ç—å 3 (–±—ã—Å—Ç—Ä–æ)</span><span class="help-score-val hl-gold">3 —Å–µ–∫</span></div>
    <p style="margin-top:8px">–°–∫–æ—Ä–æ—Å—Ç—å –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üëÅ –†–ï–ñ–ò–ú –ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–Ø</div>
  <div class="help-text">
    <p>–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å <span class="hl-green">–ù–ê–ë–õ–Æ–î–ê–¢–ï–õ–¨</span> –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –ø–∞—Ä–µ ‚Äî –∫–æ–≥–¥–∞ —Ç—Ä–µ–Ω–µ—Ä –∏–ª–∏ –≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫ —Å–ª–µ–¥–∏—Ç –∑–∞ —ç–∫—Ä–∞–Ω–æ–º, –ø–æ–∫–∞ —Ç—ã –∏–≥—Ä–∞–µ—à—å —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏.</p>
    <p>–ö–æ–≥–¥–∞ —Ä–µ–∂–∏–º <span class="hl-green">–≤–∫–ª—é—á—ë–Ω</span>: –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –º—É—Ö–∞ –ø–æ–∫–∏–¥–∞–µ—Ç –ø–æ–ª–µ, —ç–∫—Ä–∞–Ω –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–º. –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —ç—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª –∏ –∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –Ω–∞–∂–∞—Ç—å –°–¢–û–ü ‚Äî –Ω–æ —Ç—ã –æ–± —ç—Ç–æ–º –Ω–µ –∑–Ω–∞–µ—à—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –≥–ª–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–µ–Ω–µ—Ä—É —Ç–æ—á–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ—é —Ä–µ–∞–∫—Ü–∏—é.</p>
    <p>–ö–æ–≥–¥–∞ —Ä–µ–∂–∏–º <span class="hl-red">–≤—ã–∫–ª—é—á—ë–Ω</span>: –Ω–∏–∫–∞–∫–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –º—É—Ö–∏ –Ω–µ—Ç. –¢—ã –∏–≥—Ä–∞–µ—à—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—Å–ª–µ–ø—É—é –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìê –ö–û–ú–ê–ù–î–´ –í –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –û–¢ –ü–û–õ–Ø</div>
  <div class="help-text">
    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–æ –ø–∞–¥–µ–Ω–∏—è –º—É—Ö–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—è ‚Äî —á–µ–º –±–æ–ª—å—à–µ –ø–æ–ª–µ, —Ç–µ–º –¥–ª–∏–Ω–Ω–µ–µ —Å–µ—Ä–∏—è:</p>
    <div class="help-score-row"><span>–ü–æ–ª–µ 5√ó5 –∏ 6√ó6</span><span class="help-score-val hl-green">4 ‚Äì 15 –∫–æ–º–∞–Ω–¥</span></div>
    <div class="help-score-row"><span>–ü–æ–ª–µ 7√ó7 –∏ –±–æ–ª—å—à–µ</span><span class="help-score-val hl-green">7 ‚Äì 20 –∫–æ–º–∞–Ω–¥</span></div>
    <p style="margin-top:8px">–ú—É—Ö–∞ <span class="hl-red">–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ</span> –ø–æ–∫–∏–¥–∞–µ—Ç –ø–æ–ª–µ –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ ‚Äî –Ω–µ —Ä–∞–Ω—å—à–µ –∏ –Ω–µ –ø–æ–∑–∂–µ.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìà –£–†–û–í–ù–ò</div>
  <div class="help-text">
    <p>–£—Ä–æ–≤–µ–Ω—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –æ—á–∫–∞–º: –∫–∞–∂–¥—ã–µ <span class="hl-gold">100 –æ—á–∫–æ–≤</span> ‚Äî –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å. –ï—Å–ª–∏ —Å—á—ë—Ç —É–ø–∞–¥—ë—Ç –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ ‚Äî —É—Ä–æ–≤–µ–Ω—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è.</p>
    <div class="help-score-row"><span>–£—Ä–æ–≤–µ–Ω—å 1</span><span class="help-score-val hl-green">0 ‚Äì 99 –æ—á–∫–æ–≤</span></div>
    <div class="help-score-row"><span>–£—Ä–æ–≤–µ–Ω—å 2</span><span class="help-score-val hl-green">100 ‚Äì 199 –æ—á–∫–æ–≤</span></div>
    <div class="help-score-row"><span>–£—Ä–æ–≤–µ–Ω—å N</span><span class="help-score-val hl-green">(N‚àí1)√ó100 –æ—á–∫–æ–≤</span></div>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üß† –î–õ–Ø –ß–ï–ì–û –≠–¢–û?</div>
  <div class="help-text">
    <p>–ò–≥—Ä–∞ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç <span class="hl-green">—Ä–∞–±–æ—á—É—é –ø–∞–º—è—Ç—å</span> ‚Äî —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—é –≤ —É–º–µ. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, –±—ã—Å—Ç—Ä–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
    <p>–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É–ª—É—á—à–∞—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ, –ø–æ–º–æ–≥–∞—é—Ç –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –∏ —Ä–∞–∑–≤–∏–≤–∞—é—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å ¬´–≤–∏–¥–µ—Ç—å¬ª –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ –º—ã—Å–ª–µ–Ω–Ω–æ ‚Äî –±–µ–∑ –æ–ø–æ—Ä—ã –Ω–∞ –∑—Ä–µ–Ω–∏–µ.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üí° –°–û–í–ï–¢–´</div>
  <div class="help-text">
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>–ù–∞—á–∏–Ω–∞–π —Å –ø–æ–ª—è 5√ó5 –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ 1. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π –ø–æ–ª–µ –≤ –≥–æ–ª–æ–≤–µ ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π –∫–ª–µ—Ç–∫–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ –º—É—Ö–∏.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>–ù–µ —Ç–æ—Ä–æ–ø–∏—Å—å –Ω–∞–∂–∏–º–∞—Ç—å –°–¢–û–ü ‚Äî –ª—É—á—à–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω –ª–∏—à–Ω–∏–π —Ö–æ–¥, —á–µ–º –Ω–∞–∂–∞—Ç—å —Å—Ç—Ä–µ–ª–∫—É –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-red">!</div>
      <p>–ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª –ø–æ–∑–∏—Ü–∏—é ‚Äî –ª—É—á—à–µ –Ω–∞–∂–º–∏ –°–¢–û–ü. –®—Ç—Ä–∞—Ñ –∑–∞ —Ä–∞–Ω–Ω–µ–µ –Ω–∞–∂–∞—Ç–∏–µ –º–µ–Ω—å—à–µ, —á–µ–º –∑–∞ —Å–µ—Ä–∏—é —Å—Ç—Ä–µ–ª–æ–∫.</p>
    </div>
  </div>
</div>
    `,
  },
  en: {
    title:        'REMEMBER THE FLY',
    subtitle:     'MEMORY & ATTENTION TRAINING',
    lblScore:     'SCORE',
    lblRound:     'ROUND',
    lblLevel:     'LEVEL',
    lblSpeed:     'SPEED',
    lblGrid:      'GRID:',
    cmdStart:     'PRESS START',
    phaseIdle:    '‚Äî choose grid size and press START ‚Äî',
    phaseMemorize:'‚Äî <span>memorize</span> ‚Äî close your eyes ‚Äî listen ‚Äî',
    phasePlaying: '‚Äî <span>eyes closed</span> ‚Äî listen and press arrows ‚Äî',
    phaseFlyOut:  '‚Äî fly is out! press <span class="warn">STOP</span> ‚Äî',
    phasePenalty: n => `‚Äî <span class="warn">penalty √ó${n}!</span> press <span class="warn">STOP</span>! ‚Äî`,
    cmdMemorize:  'MEMORIZE POSITION',
    cmdWait:      '...',
    btnStart:     '‚ñ∂ START',
    btnStop:      '‚éµ STOP',
    btnReset:     '‚Ü∫ RESET',
    btnAgain:     '‚ñ∂ PLAY AGAIN',
    btnFullReset: '‚Ü∫ FULL RESET',
    levelLabel:   n => `LEVEL ${n}`,
    levelNext:    n => `next level: ${n} pts`,
    resultWin:    'CORRECT!',
    resultLose:   'MISS!',
    detailWin:    n => `Fly exited after ${n} commands.\nPerfect reaction! No penalties.`,
    detailTooEarly: 'Fly was still on the grid!\nYou pressed stop too early.',
    detailPenalty:  n => `Fly was out but you pressed arrows √ó${n} instead of STOP.\nThat\'s a loss!`,
    levelUpBadge: '‚¨Ü LEVEL UP!',
    cmds:     ['up','down','left','right'],
    speakCmd: cmd => `fly ${cmd}`,
    dispCmd:  cmd => `FLY ‚Äî ${cmd.toUpperCase()}`,
    ttsLang:  'en-US',
    helpBtn:  '? RULES',
    helpTitle:'HOW TO PLAY',
    lblSpectator: 'SPECTATOR',
    helpHTML: `
<div class="help-section">
  <div class="help-section-title">üéØ WHAT IS THIS GAME?</div>
  <div class="help-text">
    <p>"Remember the Fly" is a memory and attention trainer. A fly sits on a grid cell. You memorize its position, close your eyes, and track its movement by ear. Your goal is to sense when the fly has left the grid and press <span class="hl-gold">STOP</span> at the right moment.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üïµÔ∏è HISTORY: INTELLIGENCE TRAINING</div>
  <div class="help-text">
    <p>This technique was used in the training of intelligence and counter-intelligence agents by various special services. Officers were required to hold complex spatial schemas in memory ‚Äî positions of objects, routes, locations ‚Äî and mentally track their changes in real time, without the ability to take notes.</p>
    <p>The exercise trains <span class="hl-green">working memory under pressure</span> ‚Äî a critical skill in environments where mistakes are not an option. Similar methods were used in the training of fighter pilots, air traffic controllers, and top-level chess players.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìã HOW TO PLAY ‚Äî STEP BY STEP</div>
  <div class="help-text">
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">1</div>
      <p><span class="hl-gold">Set up the grid and speed.</span> Choose a grid size from 5√ó5 to 20√ó20 and speed 1‚Äì3. Speed controls how long you have to respond after each command.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">2</div>
      <p><span class="hl-gold">Press START.</span> The fly appears on the grid. You have 3 seconds ‚Äî <span class="hl-green">memorize its position.</span></p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">3</div>
      <p><span class="hl-gold">Close your eyes.</span> Once you've memorized the position, close your eyes. The fly disappears from the screen.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">4</div>
      <p><span class="hl-gold">Listen to commands.</span> A voice will say "Fly up", "Fly left", etc. After each command press the matching <span class="hl-green">arrow key</span> ‚Äî this confirms you heard it.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">5</div>
      <p><span class="hl-gold">Track mentally.</span> Keep the fly's position in your head. Each command moves it one cell in that direction.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-gold">6</div>
      <p>When you feel that the latest command has moved the fly <span class="hl-red">off the grid</span> ‚Äî immediately press <span class="hl-gold">STOP (spacebar)</span>.</p>
    </div>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üèÜ SCORING</div>
  <div class="help-text">
    <div class="help-score-row">
      <span>Pressed STOP right after fly exited</span>
      <span class="help-score-val hl-green">+10</span>
    </div>
    <div class="help-score-row">
      <span>Pressed arrow instead of STOP (fly already out)</span>
      <span class="help-score-val hl-red">‚àí1 each</span>
    </div>
    <div class="help-score-row">
      <span>Pressed STOP while fly still on grid</span>
      <span class="help-score-val hl-red">‚àí5</span>
    </div>
    <p style="margin-top:10px">If you press even one arrow key after the fly exits ‚Äî that's a <span class="hl-red">loss</span>, even if you press STOP afterward.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">‚è± TIMER & SPEED</div>
  <div class="help-text">
    <p>After each command a timer bar appears. You have a window to press an arrow ‚Äî otherwise the next command fires automatically.</p>
    <div class="help-score-row"><span>Speed 1 (slow)</span><span class="help-score-val hl-gold">10 sec</span></div>
    <div class="help-score-row"><span>Speed 2 (medium)</span><span class="help-score-val hl-gold">7 sec</span></div>
    <div class="help-score-row"><span>Speed 3 (fast)</span><span class="help-score-val hl-gold">3 sec</span></div>
    <p style="margin-top:8px">Speed can only be changed between rounds.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üëÅ SPECTATOR MODE</div>
  <div class="help-text">
    <p>The <span class="hl-green">SPECTATOR</span> toggle is designed for use with a training partner ‚Äî a coach or second player who watches the screen while you play with your eyes closed.</p>
    <p>When spectator mode is <span class="hl-green">on</span>: the moment the fly exits the grid, the screen flashes red. The spectator sees this signal and knows you should press STOP ‚Äî but you don't, because your eyes are closed. This lets the trainer track your reaction precisely.</p>
    <p>When spectator mode is <span class="hl-red">off</span>: there is no visual indication on screen when the fly exits. You play completely blind with no cues visible to anyone watching.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìê COMMANDS BY GRID SIZE</div>
  <div class="help-text">
    <p>The number of commands before the fly exits depends on the grid size ‚Äî larger grids mean longer sequences:</p>
    <div class="help-score-row"><span>Grid 5√ó5 and 6√ó6</span><span class="help-score-val hl-green">4 ‚Äì 15 commands</span></div>
    <div class="help-score-row"><span>Grid 7√ó7 and larger</span><span class="help-score-val hl-green">7 ‚Äì 20 commands</span></div>
    <p style="margin-top:8px">The fly is <span class="hl-red">guaranteed</span> to exit within this range ‚Äî never earlier, never later.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üìà LEVELS</div>
  <div class="help-text">
    <p>Your level is based on score: every <span class="hl-gold">100 points</span> = one level up. If your score drops below a threshold, your level decreases too.</p>
    <div class="help-score-row"><span>Level 1</span><span class="help-score-val hl-green">0 ‚Äì 99 pts</span></div>
    <div class="help-score-row"><span>Level 2</span><span class="help-score-val hl-green">100 ‚Äì 199 pts</span></div>
    <div class="help-score-row"><span>Level N</span><span class="help-score-val hl-green">(N‚àí1)√ó100 pts</span></div>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üß† WHY TRAIN THIS?</div>
  <div class="help-text">
    <p>This game trains your <span class="hl-green">working memory</span> ‚Äî the ability to hold and manipulate information mentally. It's the foundation of focus, fast thinking, and spatial reasoning.</p>
    <p>Regular practice improves concentration, helps with learning, and builds the ability to "see" things in your mind ‚Äî without relying on your eyes.</p>
  </div>
</div>

<div class="help-section">
  <div class="help-section-title">üí° TIPS</div>
  <div class="help-text">
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>Start with a 5√ó5 grid and speed 1. Increase gradually as you improve.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>Visualize the grid in your head ‚Äî picture the cells and the fly moving.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-green">‚úì</div>
      <p>Don't rush to press STOP ‚Äî it's better to miss by one move than to press an arrow after the fly exits.</p>
    </div>
    <div class="help-rule">
      <div class="help-rule-icon icon-red">!</div>
      <p>If you lose track ‚Äî press STOP immediately. The ‚àí5 penalty is less damaging than a string of ‚àí1s.</p>
    </div>
  </div>
</div>
    `,
  }
};

const DELTA = {
  –≤–≤–µ—Ä—Ö:[0,-1], –≤–Ω–∏–∑:[0,1], –≤–ª–µ–≤–æ:[-1,0], –≤–ø—Ä–∞–≤–æ:[1,0],
  up:[0,-1], down:[0,1], left:[-1,0], right:[1,0]
};

const WAIT_MS = [10000, 7000, 3000];
const scoreToLevel = s => Math.max(1, Math.floor(Math.max(0,s) / 100) + 1);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lang = 'ru';
let L    = T.ru;

let G = {
  size: 5, totalScore: 0, roundNum: 0, speedIndex: 0,
  phase: 'idle', flyPos: {x:2,y:2}, flyOut: false,
  penaltyCount: 0, cmdQueue: [], cmdIdx: 0,
  waitTimeout: null, timerStart: 0, timerRaf: null, awaitingInput: false,
  spectatorMode: false,
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LANGUAGE SWITCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setLang(l) {
  if (G.phase !== 'idle') return;
  lang = l; L = T[l];
  document.getElementById('btnRU').classList.toggle('active', l==='ru');
  document.getElementById('btnEN').classList.toggle('active', l==='en');
  applyLangUI();
}

function applyLangUI() {
  document.getElementById('appTitle').textContent      = L.title;
  document.getElementById('appSubtitle').textContent   = L.subtitle;
  document.getElementById('lblScore').textContent      = L.lblScore;
  document.getElementById('lblRound').textContent      = L.lblRound;
  document.getElementById('lblLevel').textContent      = L.lblLevel;
  document.getElementById('lblSpeed').textContent      = L.lblSpeed;
  document.getElementById('lblGrid').textContent       = L.lblGrid;
  document.getElementById('lblSpectator').textContent  = L.lblSpectator;
  document.getElementById('commandText').textContent   = L.cmdStart;
  document.getElementById('phaseText').innerHTML       = L.phaseIdle;
  document.getElementById('startBtn').textContent      = L.btnStart;
  document.getElementById('spaceBtn').textContent      = L.btnStop;
  document.getElementById('resetBtn').textContent      = L.btnReset;
  document.getElementById('resultPlayBtn').textContent = L.btnAgain;
  document.getElementById('resultResetBtn').textContent= L.btnFullReset;
  document.getElementById('levelUpBadge').textContent  = L.levelUpBadge;
  document.getElementById('helpBtn').textContent       = L.helpBtn;
  document.getElementById('helpTitleEl').textContent   = L.helpTitle;
  document.title = L.title.charAt(0) + L.title.slice(1).toLowerCase();
  updateLevelUI();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SPECTATOR MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleSpectator(checked) {
  G.spectatorMode = checked;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELP PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openHelp() {
  document.getElementById('helpBody').innerHTML = L.helpHTML;
  document.getElementById('helpTitleEl').textContent = L.helpTitle;
  document.getElementById('helpPanel').classList.add('show');
  document.getElementById('helpOverlay').classList.add('show');
  document.getElementById('helpBody').scrollTop = 0;
}

function closeHelp() {
  document.getElementById('helpPanel').classList.remove('show');
  document.getElementById('helpOverlay').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function changeSpeed(d) {
  if (G.phase !== 'idle') return;
  G.speedIndex = Math.max(0, Math.min(2, G.speedIndex + d));
  document.getElementById('speedVal').textContent  = G.speedIndex + 1;
  document.getElementById('speedDown').disabled    = G.speedIndex <= 0;
  document.getElementById('speedUp').disabled      = G.speedIndex >= 2;
}

function changeSize(d) {
  if (G.phase !== 'idle') return;
  G.size = Math.max(5, Math.min(20, G.size + d));
  document.getElementById('sizeVal').textContent = `${G.size} √ó ${G.size}`;
  document.getElementById('sizeDown').disabled   = G.size <= 5;
  document.getElementById('sizeUp').disabled     = G.size >= 20;
  buildGrid();
}

function resetScore() {
  if (G.phase !== 'idle') return;
  G.totalScore = 0; G.roundNum = 0;
  updateScoreUI(); updateLevelUI();
  document.getElementById('roundDisplay').textContent = '‚Äî';
}

function resetAll() {
  document.getElementById('resultOverlay').classList.remove('show');
  clearTimeout(G.waitTimeout);
  cancelAnimationFrame(G.timerRaf);
  window.speechSynthesis && window.speechSynthesis.cancel();
  G.phase = 'idle'; G.awaitingInput = false;
  resetScore();
  setGridGlow('');
  document.getElementById('grid').className        = '';
  document.getElementById('commandText').textContent = L.cmdStart;
  document.getElementById('phaseText').innerHTML     = L.phaseIdle;
  document.getElementById('spaceBtn').disabled       = true;
  setTimerPct(1);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GRID
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildGrid() {
  const grid = document.getElementById('grid');
  const s = G.size;

  // Reserve space for all UI elements outside the grid (measured in px)
  // title+subtitle ~50, stats ~36, levelbar ~20, timerbar ~12, sizerow ~36,
  // commandbox ~58, phasetext ~20, arrowkeys ~72, buttons ~38, gaps ~60
  const reservedH = 420;
  const availH = window.innerHeight - reservedH;
  const availW = Math.min(window.innerWidth * 0.92, 480);

  // Cell size = smallest of: fit-in-width or fit-in-height, max 56px
  const csW = Math.floor(availW / s);
  const csH = Math.floor(Math.max(availH, 80) / s);
  const cs  = Math.min(csW, csH, 56);

  grid.style.gridTemplateColumns = `repeat(${s},${cs}px)`;
  grid.style.gridTemplateRows    = `repeat(${s},${cs}px)`;
  grid.innerHTML = '';
  for (let r = 0; r < s; r++) for (let c = 0; c < s; c++) {
    const cell = document.createElement('div');
    cell.className = 'cell'; cell.id = `c-${c}-${r}`;
    const lbl = document.createElement('span');
    lbl.className = 'cell-label';
    lbl.textContent = String.fromCharCode(65+c) + (r+1);
    cell.appendChild(lbl); grid.appendChild(cell);
  }
}

function renderFly(visible) {
  const s = G.size;
  for (let r = 0; r < s; r++) for (let c = 0; c < s; c++) {
    const cell = document.getElementById(`c-${c}-${r}`);
    cell.classList.remove('has-fly');
    const old = cell.querySelector('.fly'); if (old) old.remove();
  }
  if (visible) {
    const {x,y} = G.flyPos;
    if (x >= 0 && x < s && y >= 0 && y < s) {
      const cell = document.getElementById(`c-${x}-${y}`);
      cell.classList.add('has-fly');
      const span = document.createElement('span');
      span.className = 'fly'; span.textContent = 'ü™∞';
      cell.appendChild(span);
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAME START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startGame() {
  if (G.phase !== 'idle') return;
  G.roundNum++; G.penaltyCount = 0; G.flyOut = false; G.awaitingInput = false;

  // Generate position + commands together, guaranteeing exit on move 4‚Äì15
  const round    = generateRound();
  G.flyPos       = round.startPos;
  G.cmdQueue     = round.cmdQueue;
  G.cmdIdx       = 0;
  G.phase        = 'memorize';

  buildGrid(); renderFly(true); setGridGlow('');
  document.getElementById('grid').className           = '';
  document.getElementById('roundDisplay').textContent = G.roundNum;
  document.getElementById('spaceBtn').disabled        = false;
  document.getElementById('commandText').textContent  = L.cmdMemorize;
  document.getElementById('phaseText').innerHTML      = L.phaseMemorize;
  setTimerPct(1);

  setTimeout(() => {
    if (G.phase !== 'memorize') return;
    G.phase = 'playing';
    renderFly(false);
    document.getElementById('commandText').textContent = L.cmdWait;
    document.getElementById('phaseText').innerHTML     = L.phasePlaying;
    issueNextCommand();
  }, 3000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMMAND + POSITION GENERATION
// Guarantees fly exits on move N where 4 ‚â§ N ‚â§ 15
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateRound() {
  const s       = G.size;
  const MIN_EXIT = G.size >= 7 ? 7  : 4;
  const MAX_EXIT = G.size >= 7 ? 20 : 15;
  const MAX_ATTEMPTS = 500;

  for (let attempt = 0; attempt < MAX_ATTEMPTS; attempt++) {
    // 1. Pick a starting position weighted toward center
    // Weight = 1 / (1 + distanceFromCenter) ‚Äî center cells much more likely
    let sx, sy;
    const gridCx = (s - 1) / 2, gridCy = (s - 1) / 2;

    // Build weighted pool of all non-corner positions
    const pool = [];
    const weights = [];
    for (let r = 0; r < s; r++) {
      for (let c = 0; c < s; c++) {
        if ((c === 0 || c === s-1) && (r === 0 || r === s-1)) continue; // skip corners
        const dist = Math.sqrt((c - gridCx) ** 2 + (r - gridCy) ** 2);
        pool.push([c, r]);
        weights.push(1 / (1 + dist));
      }
    }
    // Weighted random pick
    const totalW = weights.reduce((a, b) => a + b, 0);
    let rnd = Math.random() * totalW, chosen = pool[pool.length - 1];
    for (let i = 0; i < pool.length; i++) {
      rnd -= weights[i];
      if (rnd <= 0) { chosen = pool[i]; break; }
    }
    [sx, sy] = chosen;

    // 2. Generate MAX_EXIT random commands
    const cmds = Array.from({length: MAX_EXIT}, () => L.cmds[Math.random() * 4 | 0]);

    // 3. Simulate and find when fly first exits
    let cx = sx, cy = sy;
    let exitMove = -1;
    for (let i = 0; i < MAX_EXIT; i++) {
      const [dx, dy] = DELTA[cmds[i]];
      cx += dx; cy += dy;
      if (cx < 0 || cx >= s || cy < 0 || cy >= s) {
        exitMove = i + 1; // 1-based move number
        break;
      }
    }

    // 4. Exit happened in valid range [MIN_EXIT .. MAX_EXIT]
    if (exitMove >= MIN_EXIT && exitMove <= MAX_EXIT) {
      // Trim commands to only up to and including the exit move
      return { startPos: {x: sx, y: sy}, cmdQueue: cmds.slice(0, exitMove) };
    }

    // If fly never exits in MAX_EXIT moves OR exits too early ‚Üí retry
  }

  // Fallback: force exit on exactly move 4 from center using a straight run
  const cx2 = Math.floor(s / 2), cy2 = Math.floor(s / 2);
  const forceCmds = [];
  // Fill 3 safe moves going right, then force exit up
  for (let i = 0; i < 3; i++) forceCmds.push(L.cmds[0]); // up x3 (safe from center)
  forceCmds.push(L.cmds[0]); // one more up to exit if near top, else adjust
  return { startPos: {x: cx2, y: cy2}, cmdQueue: forceCmds };
}

function genCmds() { return []; } // unused ‚Äî replaced by generateRound
function topUp()   { }            // unused ‚Äî no topUp needed, exit is guaranteed

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMMAND FLOW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function issueNextCommand() {
  if (G.phase !== 'playing') return;

  const wasAlreadyOut = G.flyOut;

  // If queue exhausted but fly is out, keep generating random commands
  if (G.cmdIdx >= G.cmdQueue.length) {
    if (G.flyOut) {
      G.cmdQueue.push(L.cmds[Math.random() * 4 | 0]);
    } else {
      return;
    }
  }

  const cmd     = G.cmdQueue[G.cmdIdx++];
  const [dx,dy] = DELTA[cmd];
  G.flyPos = {x: G.flyPos.x+dx, y: G.flyPos.y+dy};

  const nowOut = G.flyPos.x < 0 || G.flyPos.x >= G.size ||
                 G.flyPos.y < 0 || G.flyPos.y >= G.size;

  if (nowOut && !G.flyOut) {
    G.flyOut = true;
    // Only flash red for spectator ‚Äî player has eyes closed and shouldn't see it
    if (G.spectatorMode) flashBrief('red');
    document.getElementById('phaseText').innerHTML = L.phaseFlyOut;
  }

  // Penalty -1 for each command pronounced AFTER fly already exited
  if (wasAlreadyOut) {
    G.penaltyCount++;
    addScore(-1);
    if (G.spectatorMode) flashBrief('red');
    document.getElementById('phaseText').innerHTML = L.phasePenalty(G.penaltyCount);
  }

  document.getElementById('commandText').textContent =
    L.dispCmd(cmd) + (G.flyOut ? ' ‚ö†' : '');

  speak(L.speakCmd(cmd));

  G.awaitingInput = true;
  startInputTimer();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INPUT TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startInputTimer() {
  const dur = WAIT_MS[G.speedIndex];
  G.timerStart = performance.now();
  const fill = document.getElementById('timerFill');
  fill.style.width = '100%'; fill.classList.remove('urgent');

  cancelAnimationFrame(G.timerRaf);
  (function tick() {
    if (!G.awaitingInput) return;
    const pct = Math.max(0, 1 - (performance.now() - G.timerStart) / dur);
    fill.style.width = (pct*100)+'%';
    if (pct < 0.25) fill.classList.add('urgent');
    else            fill.classList.remove('urgent');
    if (pct > 0) G.timerRaf = requestAnimationFrame(tick);
  })();

  G.waitTimeout = setTimeout(() => {
    if (!G.awaitingInput || G.phase !== 'playing') return;
    G.awaitingInput = false;
    stopInputTimer();
    issueNextCommand();
  }, dur);
}

function stopInputTimer() {
  clearTimeout(G.waitTimeout);
  cancelAnimationFrame(G.timerRaf);
  setTimerPct(1);
}

function setTimerPct(pct) {
  const fill = document.getElementById('timerFill');
  fill.style.width = (pct*100)+'%';
  fill.classList.remove('urgent');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STOP (spacebar)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function _handleSpace() {
  if (G.phase !== 'playing') return;
  if (G.awaitingInput) {
    G.awaitingInput = false;
    clearTimeout(G.waitTimeout);
    stopInputTimer();
  }
  G.phase = 'ended';
  window.speechSynthesis && window.speechSynthesis.cancel();
  document.getElementById('spaceBtn').disabled = true;

  if (!G.flyOut) {
    addScore(-5); flashBrief('red');
    showResult('lose', '‚àí5', L.detailTooEarly);
  } else if (G.penaltyCount === 0) {
    addScore(10); flashBrief('green');
    showResult('win', '+10', L.detailWin(G.cmdIdx));
  } else {
    flashBrief('red');
    showResult('lose', `‚àí${G.penaltyCount}`, L.detailPenalty(G.penaltyCount));
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ARROW KEYS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleArrow(code) {
  if (G.phase !== 'playing') return;

  if (G.flyOut) {
    flashKey(code, 'bad');
  } else {
    flashKey(code, 'ok');
  }

  if (G.awaitingInput) {
    G.awaitingInput = false;
    clearTimeout(G.waitTimeout);
    stopInputTimer();
    issueNextCommand();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCORE & LEVEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addScore(delta) {
  G.totalScore = Math.max(0, G.totalScore + delta);
  updateScoreUI(); updateLevelUI();
}

function updateScoreUI() {
  const el = document.getElementById('scoreDisplay');
  el.textContent = G.totalScore;
  el.className   = 'stat-value' + (G.totalScore < 0 ? ' neg' : '');
}

function updateLevelUI() {
  const level   = scoreToLevel(G.totalScore);
  const inLevel = G.totalScore % 100;
  document.getElementById('levelFill').style.width   = inLevel + '%';
  document.getElementById('levelLabel').textContent  = L.levelLabel(level);
  document.getElementById('levelNext').textContent   = L.levelNext(100 - inLevel);
  document.getElementById('winsDisplay').textContent = level;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESULT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showResult(type, scoreText, detail) {
  document.getElementById('resultTitle').textContent  = type==='win' ? L.resultWin : L.resultLose;
  document.getElementById('resultTitle').className    = `result-title ${type}`;
  document.getElementById('resultScore').textContent  = scoreText;
  document.getElementById('resultDetail').textContent = detail;
  document.getElementById('levelUpBadge').style.display = 'none';
  document.getElementById('resultOverlay').classList.add('show');
}

function closeResult() {
  document.getElementById('resultOverlay').classList.remove('show');
  G.phase = 'idle'; setGridGlow('');
  document.getElementById('grid').className          = '';
  document.getElementById('commandText').textContent = L.cmdStart;
  document.getElementById('phaseText').innerHTML     = L.phaseIdle;
  setTimerPct(1);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setGridGlow(color) {
  document.getElementById('gridWrapper').className =
    'grid-wrapper' + (color ? ` glow-${color}` : '');
}

function flashBrief(color) {
  const grid = document.getElementById('grid');
  setGridGlow(color);
  grid.classList.remove('bg-red','bg-green');
  grid.classList.add(`bg-${color}`);
  setTimeout(() => {
    grid.classList.remove('bg-red','bg-green');
    if (!(G.flyOut && G.phase==='playing')) setGridGlow('');
  }, 600);
}

function flashKey(code, tone) {
  const map = {ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'};
  const el  = document.getElementById('key-'+(map[code]||code));
  if (!el) return;
  const cls = tone==='bad' ? 'hit-bad' : 'hit-ok';
  el.classList.add(cls);
  setTimeout(() => el.classList.remove(cls), 160);
}

function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang  = L.ttsLang; u.rate = 1.05;
  window.speechSynthesis.speak(u);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RANDOM POSITION ‚Äî min 4 commands before exit
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function randomPos() {
  const s = G.size, MIN = 4, MAX_TRY = 200;
  for (let t = 0; t < MAX_TRY; t++) {
    let x, y;
    do { x = Math.random()*s|0; y = Math.random()*s|0; }
    while ((x===0||x===s-1) && (y===0||y===s-1));
    let cx=x, cy=y, steps=0, ok=true;
    for (let i=0; i<Math.min(MIN, G.cmdQueue.length); i++) {
      const [dx,dy] = DELTA[G.cmdQueue[i]];
      cx+=dx; cy+=dy;
      if (cx<0||cx>=s||cy<0||cy>=s) { ok=false; break; }
      steps++;
    }
    if (ok && steps>=MIN) return {x,y};
  }
  return {x: Math.floor(s/2), y: Math.floor(s/2)};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KEYBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', e => {
  if (e.code==='Space') { e.preventDefault(); _handleSpace(); return; }
  if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.code)) {
    e.preventDefault(); handleArrow(e.code);
  }
});

window.addEventListener('resize', () => {
  if (G.phase === 'idle') buildGrid();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
buildGrid();
applyLangUI();
</script>

<aside id="lovable-badge" role="complementary" dir="ltr" lang="en" aria-label="Edit with Lovable">
	<a id="lovable-badge-cta" target="_blank" href="https://lovable.dev/projects/ce9325ac-acf6-44f5-b1ec-8ef7941df7a6?utm_source=lovable-badge" rel="noopener" aria-label="Edit with Lovable">
		<span id="lovable-badge-text">Edit with</span>
		<svg xmlns="http://www.w3.org/2000/svg" width="52" height="16" fill="none" viewBox="0 0 52 16">
  <path fill="#FCFBF8" fill-rule="evenodd" d="M20.318 5.25c.643 0 1.206.14 1.69.418a2.81 2.81 0 0 1 1.118 1.191c.266.513.4 1.115.4 1.807s-.134 1.296-.4 1.812a2.81 2.81 0 0 1-1.118 1.193c-.484.278-1.047.418-1.69.418s-1.208-.14-1.695-.418a2.85 2.85 0 0 1-1.125-1.193c-.262-.516-.393-1.12-.393-1.812s.131-1.294.393-1.807a2.848 2.848 0 0 1 1.125-1.191c.487-.279 1.052-.418 1.695-.418Zm0 1.425c-.27 0-.504.076-.7.228-.193.147-.34.37-.443.67-.102.295-.153.66-.153 1.093 0 .435.05.801.153 1.1.102.3.25.524.443.676.196.147.43.22.7.22.27 0 .502-.073.694-.22.193-.152.341-.375.443-.67.103-.299.153-.667.153-1.106 0-.65-.112-1.145-.337-1.481a1.08 1.08 0 0 0-.953-.51ZM32.7 5.25c.61 0 1.127.1 1.549.3.422.197.74.48.953.849.217.368.325.809.325 1.32v2.704c0 .29.02.562.062.812.044.245.108.4.19.466V12h-1.935a5.895 5.895 0 0 1-.105-.684 7.745 7.745 0 0 1-.02-.228 2.293 2.293 0 0 1-.151.203c-.205.242-.47.437-.793.584-.32.143-.685.215-1.094.215-.406 0-.77-.08-1.094-.24a1.845 1.845 0 0 1-.756-.682 1.984 1.984 0 0 1-.27-1.045c0-.606.178-1.069.535-1.388.356-.324.87-.534 1.542-.633l1.125-.16c.225-.032.403-.074.534-.123a.622.622 0 0 0 .288-.196.549.549 0 0 0 .093-.327.65.65 0 0 0-.11-.367.702.702 0 0 0-.32-.27c-.14-.07-.31-.105-.51-.105-.32 0-.576.083-.768.251-.193.164-.298.39-.314.676h-1.923c.016-.434.147-.82.393-1.155.25-.34.596-.604 1.039-.792.442-.189.954-.283 1.535-.283Zm.99 3.498a.98.98 0 0 1-.215.14 2.49 2.49 0 0 1-.584.178l-.473.092c-.315.061-.553.156-.713.283-.155.127-.233.305-.233.534 0 .23.084.412.252.547.168.135.383.203.645.203s.494-.058.694-.173c.201-.118.355-.282.461-.49.11-.21.166-.448.166-.714v-.6Zm4.526-2.375c.065-.125.138-.243.221-.349.197-.25.437-.44.719-.571.282-.135.6-.203.952-.203.528 0 .988.138 1.377.412.389.275.688.67.896 1.186.21.512.314 1.12.314 1.824 0 .7-.107 1.309-.32 1.825-.213.512-.518.906-.915 1.18-.393.275-.854.412-1.383.412-.352 0-.667-.062-.946-.184a1.832 1.832 0 0 1-.7-.554 2.2 2.2 0 0 1-.234-.383V12h-1.843V3h1.862v3.373Zm1.284.296c-.274 0-.51.085-.707.253-.192.163-.338.397-.436.7a3.376 3.376 0 0 0-.148 1.05c0 .406.05.759.148 1.058.098.299.243.53.436.694.197.164.433.246.707.246.279 0 .512-.082.7-.246.193-.164.336-.395.43-.694.099-.3.148-.652.148-1.058 0-.405-.05-.757-.147-1.056-.095-.299-.238-.53-.43-.694a1.015 1.015 0 0 0-.7-.253Zm9.416-1.419c.602 0 1.136.131 1.604.393.466.262.829.643 1.086 1.143.263.5.394 1.097.394 1.794 0 .25-.002.449-.006.596H47.51c.018.288.071.538.164.75a1.3 1.3 0 0 0 .491.596c.214.13.465.196.757.196.319 0 .583-.082.792-.246.209-.167.34-.403.393-.706h1.862a2.48 2.48 0 0 1-.485 1.235 2.54 2.54 0 0 1-1.051.805c-.439.188-.949.283-1.53.283-.655 0-1.225-.125-1.708-.375a2.672 2.672 0 0 1-1.13-1.143c-.267-.508-.4-1.137-.4-1.887 0-.712.14-1.327.418-1.843a2.86 2.86 0 0 1 1.155-1.186c.491-.27 1.051-.405 1.678-.405Zm-.044 1.345c-.274 0-.516.068-.725.203a1.29 1.29 0 0 0-.479.59 2.045 2.045 0 0 0-.132.498h2.562a1.873 1.873 0 0 0-.138-.602 1.061 1.061 0 0 0-.418-.516 1.243 1.243 0 0 0-.67-.173Z" clip-rule="evenodd"></path>
  <path fill="#FCFBF8" d="m26.605 9.995 1.342-4.566h1.924L27.628 12h-2.07l-2.33-6.57h1.98l1.397 4.565Zm-13.013.143h2.256c1.632 0 1.421 1.837 1.418 1.861h-5.603V3h1.93v7.138Zm31.516 1.861h-1.862V3h1.862v8.999Z"></path>
  <path fill="url(#a)" fill-rule="evenodd" d="M2.7 3c1.492 0 2.7 1.192 2.7 2.663v1.012h.9c1.49 0 2.7 1.192 2.7 2.662S7.791 12 6.3 12H0V5.663C0 4.193 1.209 3 2.7 3Z" clip-rule="evenodd"></path>
  <defs>
    <radialgradient id="a" cx="0" cy="0" r="1" gradientTransform="matrix(-1.54236 7.07838 -10.231 -2.15602 4.627 5.022)" gradientUnits="userSpaceOnUse">
      <stop offset=".106" stop-color="#FE7B02"></stop>
      <stop offset=".394" stop-color="#FE3F21"></stop>
      <stop offset=".608" stop-color="#F858BC"></stop>
      <stop offset=".929" stop-color="#575ECF"></stop>
    </radialgradient>
  </defs>
</svg>


	</a>
	
	<span id="lovable-badge-divider" aria-hidden="true"></span>
	
	<button id="lovable-badge-close" aria-label="Dismiss" title="Dismiss" type="button">
		<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true">
			<path d="M10.646 4.646a.5.5 0 1 1 .707.708L8.707 8l2.646 2.646a.5.5 0 1 1-.707.707L8 8.707l-2.646 2.646a.5.5 0 1 1-.708-.707L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708L8 7.293l2.646-2.647Z"></path>
		</svg>
	</button>
</aside>
<script>
	// Don't show the lovable-badge if the page is in an iframe or if it's being rendered by puppeteer (screenshot service)
	if (window.self !== window.top || navigator.userAgent.includes('puppeteer')) {
		// the page is in an iframe
		var badge = document.getElementById('lovable-badge');
		if (badge) {
			badge.style.display = 'none';
		}
	}

	// Add click event listener to close button with animation
	var closeButton = document.getElementById('lovable-badge-close');
	if (closeButton) {
		closeButton.addEventListener('click', function(event) {
			event.preventDefault();
			event.stopPropagation();
			var badge = document.getElementById('lovable-badge');
			if (badge) {
				badge.classList.add('closing');
				setTimeout(function() {
					if (badge) {
						badge.style.display = 'none';
					}
				}, 240);
			}
		});
	}
</script>


</body></html>
